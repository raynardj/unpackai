---

title: Utilities


keywords: fastai
sidebar: home_sidebar

summary: "Useful function and utilities"
description: "Useful function and utilities"
nb_path: "nbs\10_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\10_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Import-Modules">Import Modules<a class="anchor-link" href="#Import-Modules"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="is_jupyter" class="doc_header"><code>is_jupyter</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>is_jupyter</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># For Test Cases (might have duplicate import because it will be in a dedicated file)</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">rmtree</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">graphviz</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">test_common.utils_4_tests</span> <span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">IMG_DIR</span><span class="p">,</span> <span class="n">check_no_log</span><span class="p">,</span> <span class="n">check_only_warning</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Image">Image<a class="anchor-link" href="#Image"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cleaning-up-error-image">Cleaning up error image<a class="anchor-link" href="#Cleaning-up-error-image"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In some cases, we have error image that will interrupt model trainging. We can use <code>[`clean_error_img`](/unpackai/utils.html#clean_error_img)</code> to clean the image folder</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="check_img" class="doc_header"><code>check_img</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>check_img</code>(<strong><code>img</code></strong>:<code>Path</code>, <strong><code>formats</code></strong>:<code>List</code>[<code>str</code>]=<em><code>['.jpg', '.jpeg', '.png', '.bmp']</code></em>)</p>
</blockquote>
<p>Check on a single image,
If it's quality is troublesome
    we unlink/ditch the image</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_error_img" class="doc_header"><code>clean_error_img</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L82" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_error_img</code>(<strong><code>path</code></strong>:<code>Path</code>, <strong><code>progress</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<ul>
<li>path: an image directory</li>
<li>progress: do we print out progress bar or not
  default True</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">images_rob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">IMG_DIR</span> <span class="o">/</span> <span class="s2">&quot;robustness&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.*&quot;</span><span class="p">))</span>
<span class="n">IMG_RGB</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">137</span><span class="p">))</span>
<span class="n">IMG_RGBA</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="n">images_rob</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images_rob</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_check_img_error</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test check_img with incorrect images&quot;&quot;&quot;</span>
    <span class="n">img_copy</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">name</span>
    <span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">img_copy</span><span class="p">)</span>
    <span class="n">check_img</span><span class="p">(</span><span class="n">img_copy</span><span class="p">)</span>
    <span class="n">check_only_warning</span><span class="p">(</span><span class="n">caplog</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">img_copy</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">img_copy</span><span class="si">}</span><span class="s2"> not be deleted&quot;</span>


<span class="k">def</span> <span class="nf">test_check_img_empty_wrong_suffix</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test check_img with wrong image that does not have a correct extension&quot;&quot;&quot;</span>
    <span class="n">img_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;empty.txt&quot;</span>
    <span class="n">img_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">check_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="n">check_no_log</span><span class="p">(</span><span class="n">caplog</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">img_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Image </span><span class="si">{</span><span class="n">img_path</span><span class="si">}</span><span class="s2"> not found&quot;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">IMG_RGB</span><span class="p">,</span> <span class="n">IMG_RGBA</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;ext&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;bmp&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_check_img_correct</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Correct that correct image is not removed&quot;&quot;&quot;</span>
    <span class="n">alpha_suffix</span> <span class="o">=</span> <span class="s2">&quot;_alpha&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getcolors</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alpha_suffix</span> <span class="ow">and</span> <span class="n">ext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;jp&quot;</span><span class="p">):</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;JPG does not support RGBA&quot;</span><span class="p">)</span>

    <span class="n">img_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;correct_image_blue</span><span class="si">{</span><span class="n">alpha_suffix</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="n">check_img</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="n">check_no_log</span><span class="p">(</span><span class="n">caplog</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">img_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;Image </span><span class="si">{</span><span class="n">img_path</span><span class="si">}</span><span class="s2"> not found&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_clean_error_img</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Test clean_error_img&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images_rob</span><span class="p">:</span>
        <span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="n">sub1</span> <span class="o">=</span> <span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;sub1&quot;</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;sub2&quot;</span>
    <span class="n">sub1</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="n">sub2</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="n">sub3</span> <span class="o">=</span> <span class="n">sub2</span> <span class="o">/</span> <span class="s2">&quot;sub3&quot;</span>
    <span class="n">sub3</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>


    <span class="p">(</span><span class="n">sub1</span> <span class="o">/</span> <span class="s2">&quot;file11.BMP&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;fake image&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">sub1</span><span class="o">/</span><span class="s2">&quot;file12 haha.jpg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;fake image&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">sub1</span> <span class="o">/</span> <span class="s2">&quot;file13 haha.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;not image&quot;</span><span class="p">)</span>
    <span class="n">IMG_RGB</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sub1</span> <span class="o">/</span> <span class="s2">&quot;img14_good.jpg&quot;</span><span class="p">)</span>
    <span class="n">IMG_RGBA</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sub1</span> <span class="o">/</span> <span class="s2">&quot;img15_good.png&quot;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">sub2</span> <span class="o">/</span> <span class="s2">&quot;file21.jpg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;fake image&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">sub2</span> <span class="o">/</span> <span class="s2">&quot;file22.jpeg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;fake image&quot;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">sub3</span> <span class="o">/</span> <span class="s2">&quot;file31.jpeg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;fake image&quot;</span><span class="p">)</span>
    <span class="n">IMG_RGB</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sub3</span> <span class="o">/</span> <span class="s2">&quot;img32_good.jpeg&quot;</span><span class="p">)</span>
    <span class="n">IMG_RGBA</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sub3</span> <span class="o">/</span> <span class="s2">&quot;img33_good.bmp&quot;</span><span class="p">)</span>


    <span class="n">good</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">bad</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Existing files:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.*&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; * </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.bmp&quot;</span><span class="p">]:</span>
            <span class="p">(</span><span class="n">good</span> <span class="k">if</span> <span class="s2">&quot;good&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; =&gt; CLEANING&quot;</span><span class="p">)</span>
    <span class="n">clean_error_img</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">good_removed</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">good</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">good_removed</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Good pictures deleted: </span><span class="si">{</span><span class="n">good_removed</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">bad_still_here</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">bad</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">bad_still_here</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Bad pictures not deleted: </span><span class="si">{</span><span class="n">bad_still_here</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Magic-function-[`hush`](/unpackai/utils.html#hush)">Magic function <code>[`hush`](/unpackai/utils.html#hush)</code><a class="anchor-link" href="#Magic-function-[`hush`](/unpackai/utils.html#hush)"> </a></h2><blockquote><p>Run things quietly...</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a magical cell function, so remember to use the <code>%%</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we have 2 versions of hush, the 1st on is the backup one, that using ipywidget as event trigger</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But this version of <code>toggle action</code> will be stuck by the ongoing interactive</p>
<p>If the process is working on some thing, you can't toggle until the end of the execution.</p>
<p>The further improvement will be move the toggle entirely to JavaScript, hence the second version</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hush-event-in-JS">Hush event in JS<a class="anchor-link" href="#Hush-event-in-JS"> </a></h3><blockquote><p>As not going through any amount of python backend after run</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hush" class="doc_header"><code>hush</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L114" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hush</code>(<strong><code>line</code></strong>, <strong><code>cell</code></strong>)</p>
</blockquote>
<p>A magic cell function to collapse the print out
%%hush
how_loud = 100
how_verbose = "very"
do_some_python_thing(how_loud, how_verbose)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Try-hushing-various-kinds-of-info">Try hushing various kinds of info<a class="anchor-link" href="#Try-hushing-various-kinds-of-info"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>html display</li>
<li>print</li>
<li>logging</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">hush</span>
import pandas as pd
import logging
logging.getLogger().setLevel(&#39;DEBUG&#39;)
a = 1
for i in range(1000):
    print(i, end=&quot;\t&quot;)
    
logging.info(&quot;a lots of text, VERBOSITY!!&quot;*100)

# a big dataframe
display(pd.DataFrame({&quot;a&quot;:[1,2]*50}))

# a big output
pd.DataFrame({&quot;b&quot;:range(100)})
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d01bf44f-f113-479e-926b-d91b981e0d1b"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d01bf44f-f113-479e-926b-d91b981e0d1b');

    console.info("loading toggle event: 534b041f-c9fd-46ce-9a59-74c3a6d46f8d")
    const toggle_hush = (e) =>{
        var op = document.querySelector(".hush_output_534b041f-c9fd-46ce-9a59-74c3a6d46f8d");
        if(op.style.display=="none"){
             op.style.display="block"

        } else {
            op.style.display="none"
        }

    }
    document.querySelector('.hush_toggle_534b041f-c9fd-46ce-9a59-74c3a6d46f8d').onclick=toggle_hush
    
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Capable-of-open/close-verbosity-during-the-main-process">Capable of open/close verbosity during the main process<a class="anchor-link" href="#Capable-of-open/close-verbosity-during-the-main-process"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">hush</span>
from time import sleep
for i in tqdm(range(10)):
    sleep(1)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="d578edcd-262a-43f9-8f91-884d477e2c82"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#d578edcd-262a-43f9-8f91-884d477e2c82');

    console.info("loading toggle event: 9d6989fe-0460-4f6a-aa7c-e1d471c5d3e1")
    const toggle_hush = (e) =>{
        var op = document.querySelector(".hush_output_9d6989fe-0460-4f6a-aa7c-e1d471c5d3e1");
        if(op.style.display=="none"){
             op.style.display="block"

        } else {
            op.style.display="none"
        }

    }
    document.querySelector('.hush_toggle_9d6989fe-0460-4f6a-aa7c-e1d471c5d3e1').onclick=toggle_hush
    
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="But-we-still-want-the-error-to-be-loud">But we still want the error to be loud<a class="anchor-link" href="#But-we-still-want-the-error-to-be-loud"> </a></h3><blockquote><p>As such information should interrupt the user</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">hush</span>
def _test_hush():
    for i in range(20):
        print(f&quot;some logging:\t{i}!&quot;)
    raise ValueError(&quot;but some error, because life!&quot;)

# Testing hush when exception is raised
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">




<div id="7cd33a8e-73c4-4df1-852a-0f93715f9470"></div>
<div class="output_subarea output_javascript ">
<script type="text/javascript">
var element = $('#7cd33a8e-73c4-4df1-852a-0f93715f9470');

    console.info("loading toggle event: a016dceb-0e6a-43ad-86e5-0e8835f63c91")
    const toggle_hush = (e) =>{
        var op = document.querySelector(".hush_output_a016dceb-0e6a-43ad-86e5-0e8835f63c91");
        if(op.style.display=="none"){
             op.style.display="block"

        } else {
            op.style.display="none"
        }

    }
    document.querySelector('.hush_toggle_a016dceb-0e6a-43ad-86e5-0e8835f63c91').onclick=toggle_hush
    
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fetching-static-files">Fetching static files<a class="anchor-link" href="#Fetching-static-files"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="static_root" class="doc_header"><code>static_root</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L173" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>static_root</code>()</p>
</blockquote>
<p>Return static path</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test the validation of such static path</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_find_static</span><span class="p">():</span>
    <span class="n">error_report_html</span> <span class="o">=</span> <span class="n">STATIC</span><span class="o">/</span><span class="s2">&quot;html&quot;</span><span class="o">/</span><span class="s2">&quot;bug&quot;</span><span class="o">/</span><span class="s2">&quot;error_report.html&quot;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">error_report_html</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">STATIC</span><span class="si">}</span><span class="s2">&#39; is not a valid static path&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Listing-files-in-DataFrame">Listing files in DataFrame<a class="anchor-link" href="#Listing-files-in-DataFrame"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="friendly_size" class="doc_header"><code>friendly_size</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L226" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>friendly_size</code>(<strong><code>size</code></strong>:<code>float</code>)</p>
</blockquote>
<p>Convert a size in bytes (as float) to a size with unit (as a string)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ls" class="doc_header"><code>ls</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L240" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ls</code>(<strong><code>root</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>exclude</code></strong>:<code>List</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>hide_info</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a DataFrame with list of files &amp; directories in a given path.</p>
<p>Args:
    root: root path to look for files and directories recursively
    exclude: optional list of names to exclude in the search (e.g. <code>[".git"]</code>)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;size,exp&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;0.00 B&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1.00 B&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;1.00 KB&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;1.00 MB&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">3.14</span><span class="p">,</span> <span class="s2">&quot;3.14 GB&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_friendly_size</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test computation of friendly size (human readable)&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">friendly_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">populated_tmp_dir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create files to test `ls` function&quot;&quot;&quot;</span>
    <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dir1/subdir1&quot;</span><span class="p">,</span> <span class="s2">&quot;dir1/subdir2&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2&quot;</span><span class="p">]:</span>
        <span class="p">(</span><span class="n">tmpdir</span> <span class="o">/</span> <span class="n">dir_</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;dir1/subdir1/at_subdir.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2/at_dir.txt&quot;</span><span class="p">]:</span>
        <span class="p">(</span><span class="n">tmpdir</span> <span class="o">/</span> <span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;unpackai&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">tmpdir</span> <span class="o">/</span> <span class="s2">&quot;dir1&quot;</span> <span class="o">/</span> <span class="s2">&quot;subdir2&quot;</span> <span class="o">/</span> <span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;3141590000&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tmpdir</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">exp_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Parent&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Level&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Last_Modif&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FileDir&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Size&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Friendly_Size&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">test_ls</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test DataFrame generated by `ls` function&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">)</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">exp_columns</span><span class="p">,</span> <span class="s2">&quot;Incorrect columns in DF&quot;</span>

    <span class="c1"># We want to copy the list of expecgted columns to keep it intact</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">exp_columns</span><span class="p">[:]</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Last_Modif&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Last_Modif&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Last_Modif&quot;</span><span class="p">)</span>

    <span class="c1"># We check the file &quot;at_root.txt&quot; and do some cleanup</span>
    <span class="n">at_root</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;at_root.txt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">at_root</span><span class="p">[</span><span class="s2">&quot;Path&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="n">populated_tmp_dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;at_root.txt&quot;</span>
    <span class="k">assert</span> <span class="n">at_root</span><span class="p">[</span><span class="s2">&quot;Friendly_Size&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">friendly_size</span><span class="p">(</span><span class="n">at_root</span><span class="p">[</span><span class="s2">&quot;Size&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Path&quot;</span><span class="p">,</span> <span class="s2">&quot;Friendly_Size&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Path&quot;</span><span class="p">)</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Friendly_Size&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===TRUNCATED DF FOR LIST OF FILES/DIR===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">exp_root_dir</span> <span class="o">=</span> <span class="n">populated_tmp_dir</span><span class="o">.</span><span class="n">name</span>
    <span class="n">df_exp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span> <span class="n">exp_root_dir</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;dir1&quot;</span><span class="p">,</span> <span class="n">exp_root_dir</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Dir&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;subdir1&quot;</span><span class="p">,</span> <span class="s2">&quot;dir1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Dir&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;at_subdir.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir1&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;subdir2&quot;</span><span class="p">,</span> <span class="s2">&quot;dir1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Dir&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir2&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;.pkl&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;dir2&quot;</span><span class="p">,</span> <span class="n">exp_root_dir</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Dir&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;at_dir.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===EXPECTED DF FOR LIST OF FILES/DIR===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_exp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">compare_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">df_exp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">compare_df</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Differences found when checking DF:</span><span class="se">\n</span><span class="si">{</span><span class="n">compare_df</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="n">exp_files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dir1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subdir1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;at_subdir.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subdir2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dir2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;at_dir.txt&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">exp_dir1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2&quot;</span><span class="p">,</span> <span class="s2">&quot;at_dir.txt&quot;</span><span class="p">]</span>
<span class="n">exp_dir2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dir1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subdir1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subdir2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;at_subdir.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">exp_subdir</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dir1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dir2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subdir2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;at_dir.txt&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">exp_dir2_subdir</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;at_root.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;dir1&quot;</span><span class="p">,</span> <span class="s2">&quot;subdir2&quot;</span><span class="p">,</span> <span class="s2">&quot;some_pickle.pkl&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">test_ls_path_as_str</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test `ls` function called with a string for path&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">exp_files</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;exclude, exp&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">([],</span> <span class="n">exp_files</span><span class="p">),</span>
        <span class="p">([</span><span class="s2">&quot;I am not a Dir&quot;</span><span class="p">],</span> <span class="n">exp_files</span><span class="p">),</span>
        <span class="p">([</span><span class="s2">&quot;dir1&quot;</span><span class="p">],</span> <span class="n">exp_dir1</span><span class="p">),</span>
        <span class="p">([</span><span class="s2">&quot;dir2&quot;</span><span class="p">],</span> <span class="n">exp_dir2</span><span class="p">),</span>
        <span class="p">([</span><span class="s2">&quot;subdir1&quot;</span><span class="p">],</span> <span class="n">exp_subdir</span><span class="p">),</span>
        <span class="p">([</span><span class="s2">&quot;subdir1&quot;</span><span class="p">,</span> <span class="s2">&quot;dir2&quot;</span><span class="p">],</span> <span class="n">exp_dir2_subdir</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_ls_exclude</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">populated_tmp_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test `ls` function with an exclusion of some directories&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_ls_no_info</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test `ls` function with `hide_info` set to True&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">populated_tmp_dir</span><span class="p">,</span> <span class="n">hide_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">exp_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="s2">&quot;Friendly_Size&quot;</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">test_ls_not_exist</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test `ls` when path does not exist&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">ls</span><span class="p">(</span><span class="s2">&quot;this_path_does_not_exist&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_not_dir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test `ls` if root is a file and not a dir&quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;toto.txt&quot;</span>
    <span class="n">file_path</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">ls</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="GraphViz">GraphViz<a class="anchor-link" href="#GraphViz"> </a></h2><p>Drawing a Graphviz Graph in Jupyter</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gv" class="doc_header"><code>gv</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L257" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gv</code>(<strong><code>source</code></strong>:<code>str</code>, <strong><code>rankdir</code></strong>=<em><code>'LR'</code></em>)</p>
</blockquote>
<p>Generate a GraphViz diagram, with a settable orientation (i.e. rankdir)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gv</span><span class="p">(</span><span class="s2">&quot;program[shape=box3d width=1 height=0.7] inputs-&gt;program-&gt;results&quot;</span><span class="p">)</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;filename&#39;: &#39;Source.gv&#39;,
 &#39;_encoding&#39;: &#39;utf-8&#39;,
 &#39;source&#39;: &#39;digraph G {  rankdir=&#34;LR&#34; program[shape=box3d width=1 height=0.7] inputs-&gt;program-&gt;results; }&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;rankdir&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;LR&quot;</span><span class="p">,</span> <span class="s2">&quot;TD&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_gv</span><span class="p">(</span><span class="n">rankdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test Graphviz Generation via `gv`&quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="s2">&quot;inputs-&gt;program-&gt;results&quot;</span>
    <span class="k">if</span> <span class="n">rankdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">gv</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">rankdir</span> <span class="o">=</span> <span class="s2">&quot;LR&quot;</span>  <span class="c1"># default orientation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">gv</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="n">rankdir</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">graph</span><span class="p">,</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Source</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Output shall be a GraphViz Source (but is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="n">gv_src</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">source</span>
    <span class="k">assert</span> <span class="n">gv_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;digraph&quot;</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Source is not a digraph: </span><span class="si">{</span><span class="n">gv_src</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">gv_src</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Source input not in Graph Source: </span><span class="si">{</span><span class="n">gv_src</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="sa">f</span><span class="s1">&#39;rankdir=&quot;</span><span class="si">{</span><span class="n">rankdir</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="ow">in</span> <span class="n">gv_src</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rankdir </span><span class="si">{</span><span class="n">rankdir</span><span class="si">}</span><span class="s2"> not found: </span><span class="si">{</span><span class="n">gv_src</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Download-and-unzip-utilities">Download and unzip utilities<a class="anchor-link" href="#Download-and-unzip-utilities"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download-&amp;-url_2_text">Download &amp; url_2_text<a class="anchor-link" href="#Download-&amp;-url_2_text"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_url_size" class="doc_header"><code>get_url_size</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L264" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_url_size</code>(<strong><code>url</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Returns the size of URL, or -1 if it cannot get it</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download" class="doc_header"><code>download</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L274" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download</code>(<strong><code>url</code></strong>:<code>str</code>, <strong><code>dest</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Download file and return the Path of the downloaded file</p>
<p>If the destination is not specified, download in the current directory
with the name specified in the URL</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="url_2_text" class="doc_header"><code>url_2_text</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L303" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>url_2_text</code>(<strong><code>url</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Extract text content from an URL (textual content for an HTML)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GITHUB_TEST_DATA_URL</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/unpackAI/unpackai/main/test/test_data/&quot;</span>
<span class="n">url_raw_txt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITHUB_TEST_DATA_URL</span><span class="si">}</span><span class="s2">/to_download.txt&quot;</span>
<span class="n">test_data_txt</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;to_download.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_connection_github</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;HEAD&quot;</span><span class="p">,</span> <span class="n">url_raw_txt</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="n">resp</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ReadTimeout</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot connect to Github: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_get_url_size</span><span class="p">(</span><span class="n">check_connection_github</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">get_url_size</span><span class="p">(</span><span class="n">url_raw_txt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">264</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Wrong size for </span><span class="si">{</span><span class="n">url_raw_txt</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">test_download_dest</span><span class="p">(</span><span class="n">check_connection_github</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test download of file to a destination&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span> <span class="o">/</span> <span class="s2">&quot;to_download.txt&quot;</span><span class="p">)</span>
    <span class="n">download</span><span class="p">(</span><span class="n">url_raw_txt</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dest</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">dest</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">test_data_txt</span>


<span class="k">def</span> <span class="nf">test_download_empty</span><span class="p">(</span><span class="n">check_connection_github</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test download of file without destination&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;to_download.txt&quot;</span><span class="p">)</span>
    <span class="n">download</span><span class="p">(</span><span class="n">url_raw_txt</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">dest</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">dest</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span> <span class="o">==</span> <span class="n">test_data_txt</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_url_2_text</span><span class="p">(</span><span class="n">check_connection_github</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test extraction of text from URL&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">url_2_text</span><span class="p">(</span><span class="n">url_raw_txt</span><span class="p">)</span> <span class="o">==</span> <span class="n">test_data_txt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Unpack-&amp;-Download-unpack">Unpack &amp; Download-unpack<a class="anchor-link" href="#Unpack-&amp;-Download-unpack"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_and_unpack" class="doc_header"><code>download_and_unpack</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L329" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_and_unpack</code>(<strong><code>url</code></strong>:<code>str</code>, <strong><code>extract_dir</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>]=<em><code>None</code></em>, <strong><code>fmt</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Download a file and unzip it. Returns the path of unzipped directory</p>
<p>Args:
    url: URL of the archive to download
    extract_dir: name of the target directory, where the archive is unpacked.
                If not provided, <working directory> / <archive name without extesion> is used.
    fmt: archive format (one of "zip", "tar", "gztar", "bztar",or "xztar").
            Or any other registered format. If not provided, it is guessed from extension.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url_ar</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;https://alaska.usgs.gov/data/landBirds/sewardPeninsula/2012/&quot;</span>
    <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.zip&quot;</span>
<span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">url_ar</span><span class="p">,</span> <span class="n">url_ar</span> <span class="o">+</span> <span class="s2">&quot;?x=123&quot;</span><span class="p">],</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;url?x=y&quot;</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;unzip_dir&quot;</span><span class="p">],</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;no dest&quot;</span><span class="p">,</span> <span class="s2">&quot;dest&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_download_and_unpack</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test download and unzip with `download_and_unpack`&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">stem</span>

    <span class="n">extract_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span> <span class="o">/</span> <span class="n">dest</span><span class="p">)</span>
    <span class="n">download_and_unpack</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">extract_dir</span><span class="o">=</span><span class="n">extract_dir</span><span class="p">)</span>

    <span class="n">df_files</span> <span class="o">=</span> <span class="n">ls</span><span class="p">(</span><span class="n">extract_dir</span><span class="p">)</span>
    <span class="n">obt_files</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_files</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">df_files</span><span class="o">.</span><span class="n">Size</span><span class="p">)}</span>

    <span class="n">exp_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.csv&quot;</span><span class="p">:</span> <span class="mi">60617</span><span class="p">,</span>
        <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.html&quot;</span><span class="p">:</span> <span class="mi">22883</span><span class="p">,</span>
        <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.xml&quot;</span><span class="p">:</span> <span class="mi">14408</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">obt_files</span> <span class="o">==</span> <span class="n">exp_files</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Differences found in list of files:</span><span class="se">\n</span><span class="si">{</span><span class="n">obt_files</span><span class="si">}</span><span class="se">\n</span><span class="s2">vs</span><span class="se">\n</span><span class="si">{</span><span class="n">exp_files</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CSV-in-archive-to-DataFrame">CSV in archive to DataFrame<a class="anchor-link" href="#CSV-in-archive-to-DataFrame"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv_from_zip" class="doc_header"><code>read_csv_from_zip</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/utils.py#L383" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv_from_zip</code>(<strong><code>archive</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>csv_path</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>])</p>
</blockquote>
<p>Load a CSV file inside a zip/tar and returns the equivalent pandas <code>DataFrame</code></p>
<p>Args:
    archive: path or URL of the zip (or tar/tag.gz) file
    csv_path: path of csv relative to root of archive
        Note: if root is a folder, csv_path shall include this path (e.g. "archive/my_table.csv")</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LOCAL_ZIP_FLAT</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;archive.zip&quot;</span>
<span class="n">LOCAL_TAR_FLAT</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;archive.tar&quot;</span>
<span class="n">LOCAL_GZ_FLAT</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;archive.tar.gz&quot;</span>
<span class="n">LOCAL_ZIP_FOLDER</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;archived_folder.zip&quot;</span>
<span class="n">GITHUB_ZIP_FLAT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITHUB_TEST_DATA_URL</span><span class="si">}</span><span class="s2">/archive.zip&quot;</span>
<span class="n">GITHUB_ZIP_FOLDER</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITHUB_TEST_DATA_URL</span><span class="si">}</span><span class="s2">/archived_folder.zip&quot;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;archive,csv&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FLAT</span><span class="p">,</span> <span class="s2">&quot;100_rows.csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_TAR_FLAT</span><span class="p">,</span> <span class="s2">&quot;100_rows.csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_GZ_FLAT</span><span class="p">,</span> <span class="s2">&quot;100_rows.csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FOLDER</span><span class="p">,</span> <span class="s2">&quot;archived_folder/100_rows (folder).csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FOLDER</span><span class="p">,</span> <span class="s2">&quot;archived_folder/sub_folder/100_rows (subfolder).csv&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flat (zip)&quot;</span><span class="p">,</span> <span class="s2">&quot;flat (tar)&quot;</span><span class="p">,</span> <span class="s2">&quot;flat (tar.gz)&quot;</span><span class="p">,</span> <span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="s2">&quot;subfolder&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_read_csv_from_zip_local</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test reading CSV from a local zip with read_csv_from_zip&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_csv_from_zip</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Result is not a DataFrame: </span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">100</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;archive,csv&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">GITHUB_ZIP_FLAT</span><span class="p">,</span> <span class="s2">&quot;100_rows.csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">GITHUB_ZIP_FOLDER</span><span class="p">,</span> <span class="s2">&quot;archived_folder/100_rows (folder).csv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">GITHUB_ZIP_FOLDER</span><span class="p">,</span> <span class="s2">&quot;archived_folder/sub_folder/100_rows (subfolder).csv&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;flat&quot;</span><span class="p">,</span> <span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="s2">&quot;subfolder&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_read_csv_from_zip_github</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">,</span> <span class="n">check_connection_github</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test reading CSV from a URL zip in GitHub with read_csv_from_zip&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_csv_from_zip</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Result is not a DataFrame: </span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">100</span>


<span class="k">def</span> <span class="nf">test_read_csv_from_zip_url</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test reading CSV from a URL zip with read_csv_from_zip&quot;&quot;&quot;</span>
    <span class="n">url_ar</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;https://alaska.usgs.gov/data/landBirds/sewardPeninsula/2012/&quot;</span>
        <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.zip&quot;</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_csv_from_zip</span><span class="p">(</span><span class="n">url_ar</span><span class="p">,</span> <span class="s2">&quot;avianHabitat_sewardPeninsula_McNew_2012.csv&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Result is not a DataFrame: </span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1070</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;archive,csv,error&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;does_not_exist.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;table.csv&quot;</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FLAT</span><span class="p">,</span> <span class="s2">&quot;does_not_exist.csv&quot;</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_TAR_FLAT</span><span class="p">,</span> <span class="s2">&quot;does_not_exist.csv&quot;</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_GZ_FLAT</span><span class="p">,</span> <span class="s2">&quot;does_not_exist.csv&quot;</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FLAT</span><span class="p">,</span> <span class="s2">&quot;not_a_csv.txt&quot;</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">LOCAL_ZIP_FLAT</span><span class="p">,</span> <span class="s2">&quot;not_a_csv&quot;</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">),</span>
        <span class="p">(</span><span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;to_download.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;table.csv&quot;</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;zip missing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csv missing (zip)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csv missing (tar)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csv missing (tar.gz)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;not csv (extension)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;not csv (no extension)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;not archive&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_read_csv_from_zip_robustness</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test robustness of read_csv_from_zip&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="n">read_csv_from_zip</span><span class="p">(</span><span class="n">archive</span><span class="p">,</span> <span class="n">csv</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><!-- Hide --></p>
<h1 id="Running-all-Test-Cases">Running all Test Cases<a class="anchor-link" href="#Running-all-Test-Cases"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

