---

title: NLP Data


keywords: fastai
sidebar: home_sidebar

summary: "Handling NLP data"
description: "Handling NLP data"
nb_path: "nbs\41_nlp_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\41_nlp_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Textual-data">Textual data<a class="anchor-link" href="#Textual-data"> </a></h2><blockquote><p>Raw &amp; pure textual data</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/unpackai/nlp_data.html#Textual"><code>Textual</code></a> can help you</p>
<h3 id="Obtaining-data">Obtaining data<a class="anchor-link" href="#Obtaining-data"> </a></h3><p>We can extract data from following sources:</p>
<ul>
<li>a URL (http or https)</li>
<li>a path to a textual file (<em>.txt</em>, not <em>.doc</em>/<em>.docx</em>)</li>
<li>an interactive interface in the notebook, asking to upload the file</li>
</ul>
<h3 id="Prepare-model-training">Prepare model training<a class="anchor-link" href="#Prepare-model-training"> </a></h3><p>We can prepare model training in the following way:</p>
<ul>
<li>Pytorch datasets, data collector for dataloader</li>
<li>Create a hugging face trainer</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Textual" class="doc_header"><code>class</code> <code>Textual</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/nlp/data.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Textual</code>(<strong><code>text</code></strong>:<code>str</code>, <strong><code>path</code></strong>:<code>Optional</code>[<code>Path</code>]=<em><code>None</code></em>)</p>
</blockquote>
<p>Obtain and manage textual data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">show_doc_methods</span><span class="p">(</span><span class="n">Textual</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Examples">Examples<a class="anchor-link" href="#Examples"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-interactive-uploading-widget">Create interactive uploading widget<a class="anchor-link" href="#Create-interactive-uploading-widget"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">uploaded</span> <span class="o">=</span> <span class="n">Textual</span><span class="o">.</span><span class="n">from_upload</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">textual</span> <span class="o">=</span> <span class="n">uploaded</span><span class="p">()</span>
<span class="n">textual</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preview textual data by page</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">textual</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="HFTextBlock">HFTextBlock<a class="anchor-link" href="#HFTextBlock"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A <code>TransformBlock</code>, designed for huggingface tokenizers</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="HFTextBlock" class="doc_header"><code>HFTextBlock</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/nlp/data.py#L198" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>HFTextBlock</code>(<strong><code>tokenizer</code></strong>, <strong>**<code>tk_kwargs</code></strong>)</p>
</blockquote>
<p>create Huggingface specialized fastai Block
tokenizer: PreTrainedTokenizer from huggingface
tk_kwargs: keyward arguments for tokenizer's <code>__call__</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># For Test Cases (might have duplicate import because it will be in a dedicated file)</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">test_common.utils_4_tests</span> <span class="kn">import</span> <span class="n">DATA_DIR</span>
<span class="kn">from</span> <span class="nn">test_utils</span> <span class="kn">import</span> <span class="n">GITHUB_TEST_DATA_URL</span><span class="p">,</span> <span class="n">check_connection_github</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LOCAL_TEST_TXT</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;to_download.txt&quot;</span>
<span class="n">GITHUB_TEST_TXT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITHUB_TEST_DATA_URL</span><span class="si">}</span><span class="s2">/to_download.txt&quot;</span>

<span class="n">LOCAL_TEST_TXT_UTF8</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;Deep learning.txt&quot;</span>
<span class="n">GITHUB_TEST_TXT_UTF8</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITHUB_TEST_DATA_URL</span><span class="si">}</span><span class="s2">/Deep%20learning.txt&quot;</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_txt_content</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">LOCAL_TEST_TXT</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">local_textual</span><span class="p">(</span><span class="n">test_txt_content</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Textual</span><span class="p">(</span><span class="n">test_txt_content</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Test_Textual</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_textual</span><span class="p">,</span> <span class="n">test_txt_content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test initialization of Textual from text&quot;&quot;&quot;</span>
        <span class="n">expected_txt</span> <span class="o">=</span> <span class="n">test_txt_content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">local_textual</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">expected_txt</span>

    <span class="k">def</span> <span class="nf">test_init_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test initialization of Textual from text&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">LOCAL_TEST_TXT_UTF8</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">textual</span> <span class="o">=</span> <span class="n">Textual</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">textual</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_textual</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test create Textual from path (existing)&quot;&quot;&quot;</span>
        <span class="n">textual</span> <span class="o">=</span> <span class="n">Textual</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">LOCAL_TEST_TXT</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">textual</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">local_textual</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">test_from_path_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test extract Textual of file that does not exist&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">FileExistsError</span><span class="p">):</span>
            <span class="n">textual</span> <span class="o">=</span> <span class="n">Textual</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s2">&quot;does_not_exist.txt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_connection_github</span><span class="p">,</span> <span class="n">local_textual</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test extract Textual from URL&quot;&quot;&quot;</span>
        <span class="n">textual</span> <span class="o">=</span> <span class="n">Textual</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">GITHUB_TEST_TXT</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">textual</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">local_textual</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;URL text: </span><span class="si">{</span><span class="n">textual</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">test_from_url_non_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_connection_github</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test extract Textual from URL with non-ascii characters&quot;&quot;&quot;</span>
        <span class="n">textual</span> <span class="o">=</span> <span class="n">Textual</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">GITHUB_TEST_TXT_UTF8</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">LOCAL_TEST_TXT_UTF8</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">textual</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">content</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;URL text: </span><span class="si">{</span><span class="n">textual</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

