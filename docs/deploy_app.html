---

title: Deploy


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs\51_deploy_app.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\51_deploy_app.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deploy-with-Streamlit-and-NGROK">Deploy with Streamlit and NGROK<a class="anchor-link" href="#Deploy-with-Streamlit-and-NGROK"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="deploy_app" class="doc_header"><code>deploy_app</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L24" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>deploy_app</code>(<strong><code>app</code></strong>=<em><code>'app.py'</code></em>)</p>
</blockquote>
<p>Deploy a streamlit app using ngrok</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utility-functions-to-load-a-module">Utility functions to load a module<a class="anchor-link" href="#Utility-functions-to-load-a-module"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_module" class="doc_header"><code>load_module</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_module</code>(<strong><code>module_path</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>module_name</code></strong>=<em><code>'module'</code></em>)</p>
</blockquote>
<p>Load and return a module</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="import_from_module" class="doc_header"><code>import_from_module</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>import_from_module</code>(<strong><code>module_path</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>name</code></strong>:<code>str</code>, <strong><code>module_name</code></strong>=<em><code>'module'</code></em>)</p>
</blockquote>
<p>Import a list of names from a module from its path</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-template-of-App">Get template of App<a class="anchor-link" href="#Get-template-of-App"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="blackify" class="doc_header"><code>blackify</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L82" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>blackify</code>(<strong><code>code</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Run "black" on a code passed as string</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Base-Template">Base Template<a class="anchor-link" href="#Base-Template"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Templates-for-CSV">Templates for CSV<a class="anchor-link" href="#Templates-for-CSV"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Templates-for-Tabular">Templates for Tabular<a class="anchor-link" href="#Templates-for-Tabular"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Templates-for-NLP">Templates for NLP<a class="anchor-link" href="#Templates-for-NLP"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Class-to-Create-Templates">Class to Create Templates<a class="anchor-link" href="#Class-to-Create-Templates"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="StreamlitApp" class="doc_header"><code>class</code> <code>StreamlitApp</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L208" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>StreamlitApp</code>(<strong><code>application</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Class to generate Streamlit App for different applications</p>
<p>Available applications: "CV", "Tabular", "NLP", and "Custom"</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Custom-App">Custom App<a class="anchor-link" href="#Custom-App"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="StreamlitAppCustom" class="doc_header"><code>class</code> <code>StreamlitAppCustom</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/deploy/app.py#L351" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>StreamlitAppCustom</code>()</p>
</blockquote>
<p>Application with custom implementation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Test">Test<a class="anchor-link" href="#Test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># For Test Cases (might have duplicate import because it will be in a dedicated file)</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">test_common.utils_4_tests</span> <span class="kn">import</span> <span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">diff_files</span>

<span class="n">DEPLOY_DATA_DIR</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;deploy&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_streamlit_cv_fastai</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test Streamlit app for CV with fastai&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;app_cv_fastai.py&quot;</span>
    <span class="n">StreamlitApp</span><span class="p">(</span><span class="s2">&quot;CV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render_fastai</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Is it a cat?&quot;</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Jeff&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;model.pkl&quot;</span><span class="p">,</span>
        <span class="n">implem_4_model</span><span class="o">=</span><span class="s2">&quot;is_cat = dummy_function&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        st.sidebar.write(&quot;---&quot;)</span>
<span class="sd">        st.sidebar.button(&quot;Show Balloons&quot;, on_click=st.balloons)</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="n">dest</span><span class="o">=</span><span class="n">dest</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">diff_files</span><span class="p">(</span><span class="n">DEPLOY_DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;app_CV.py&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_streamlit_tabular_pycaret</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test Streamlit app for Tabular with pycaret&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;app_tabular_pycaret.py&quot;</span>
    <span class="n">StreamlitApp</span><span class="p">(</span><span class="s2">&quot;Tabular&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render_pycaret</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My Mini Tabular App&quot;</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Jeff&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;model.pkl&quot;</span><span class="p">,</span>
        <span class="n">module</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">diff_files</span><span class="p">(</span><span class="n">DEPLOY_DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;app_Tabular.py&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_custom_app_code</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test custom app with code provided via string&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;app_custom_code.py&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        st.write(&quot;hello&quot;)</span>
<span class="s2">        st.balloons()</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">StreamlitAppCustom</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="s2">&quot;Custom App&quot;</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">,</span> <span class="n">code</span>
    <span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">diff_files</span><span class="p">(</span><span class="n">DEPLOY_DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;app_custom.py&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_custom_app_external</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Test custom app with code provided via string&quot;&quot;&quot;</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">tmp_path</span> <span class="o">/</span> <span class="s2">&quot;app_custom_external.py&quot;</span>

    <span class="n">StreamlitAppCustom</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="s2">&quot;Custom App&quot;</span><span class="p">,</span> <span class="s2">&quot;Jeff&quot;</span><span class="p">,</span> <span class="n">DEPLOY_DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;correct_code_for_custom_app.py&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>

    <span class="c1"># Because we have a absolute path of &quot;test_data/deploy&quot;, we will replace by relative path</span>
    <span class="c1"># otherwise our tests will always be failed</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">DEPLOY_DATA_DIR</span><span class="p">),</span> <span class="s2">&quot;&lt;deploy_dir&gt;&quot;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;r&quot;&lt;deploy_dir&gt;/&#39;</span><span class="p">,</span> <span class="s1">&#39;Path(__file__).parent / &quot;&#39;</span><span class="p">)</span>
    <span class="n">dest</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">diff_files</span><span class="p">(</span><span class="n">DEPLOY_DATA_DIR</span> <span class="o">/</span> <span class="s2">&quot;app_custom_external.py&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">.</span><span class="ansi-green-fg">                                                                                         [100%]</span>##vso[results.publish type=JUnit;runTitle=&#39;Pytest results&#39;;]e:\AnsysDev\_perso_repo\unpackai\nbs\test-output.xml
##vso[task.logissue type=warning;]Coverage XML was not created, skipping upload.

------------ generated xml file: e:\AnsysDev\_perso_repo\unpackai\nbs\test-output.xml -------------
<span class="ansi-green-intense-fg ansi-bold">4 passed</span><span class="ansi-green-fg"> in 0.27s</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

