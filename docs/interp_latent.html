---

title: Interpretation

keywords: fastai
sidebar: home_sidebar

summary: "Easy consine similarity search, search similar features among vectors is a frequently encountered situation"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/15_interp_latent.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cosine-similarity-search">Cosine similarity search<a class="anchor-link" href="#Cosine-similarity-search">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CosineSearch" class="doc_header"><code>class</code> <code>CosineSearch</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/interp/latent.py#L12" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CosineSearch</code>(<strong><code>base</code></strong>:<code>ndarray</code>)</p>
</blockquote>
<p>Build a index search on cosine distance
cos = CosineSearch(base_array)
idx_order = cos(vec)</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Search-for-similar-vecs">Search for similar vecs<a class="anchor-link" href="#Search-for-similar-vecs">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create random vector, assimuating <code>500 items x 128 embedding hidden size</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">128</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cosine</span> <span class="o">=</span> <span class="n">CosineSearch</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
<span class="n">cosine</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Consine Similarity Search] (500 items)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Rank-the-distance-to-6th-item">Rank the distance to 6th item<a class="anchor-link" href="#Rank-the-distance-to-6th-item">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cosine</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([  5, 268, 327, 309, 365,  34, 388, 173, 415, 135, 151, 461, 307,
       275, 469, 384, 416,  60, 293, 236, 153, 493, 464, 402,  74, 383,
        15, 294,  95, 485, 103, 488, 156, 122, 283, 379, 321, 477, 300,
       348, 100, 381, 317, 209, 231, 182, 174, 457, 332, 314, 256, 326,
       251, 313,   9, 183, 270, 133,  70, 424, 227, 399, 234, 205, 487,
        84,  31, 232, 322, 428, 311,  67, 380,  19, 471, 255, 419, 224,
       413, 247, 328, 436, 367,  64, 385, 279, 344, 406, 306, 238, 357,
       335, 248, 249, 312, 169, 221, 124, 297, 427,  52, 346, 136, 288,
       120,  93, 250, 495,  22, 143, 273, 206, 149, 305, 159, 438, 218,
       343, 195,  24, 142,  50, 150, 199, 434, 465, 123,  69, 223,  79,
       291, 154,  73,  10, 222,  18,  76,  68, 213, 139, 489, 323, 286,
       241, 158, 106,  92,  37, 301, 408, 141, 272,   2, 207, 179,  32,
       395, 390, 290, 366, 121, 138, 181, 292, 377,  20, 134, 282,   7,
       497, 108, 244, 210, 146, 360, 304, 404, 467, 296, 498, 472, 375,
        72, 338,  90,  43, 370,  16, 329, 362, 189, 180, 117, 168, 349,
        49, 483, 212, 391,  45, 444,  21,  17, 177, 118, 474, 201,  96,
       147, 431,  55, 478, 337, 192, 341, 363, 188,  71,  40, 127, 441,
       219, 421, 350, 400, 184, 240, 254, 451, 482,  44, 353,  33, 265,
       356, 437, 303, 442,  13, 228, 233,  81, 160, 462, 320, 420, 445,
        59, 155, 115, 264, 340, 128,  42, 387, 448,  89,  91, 246, 298,
       325, 429, 277, 476, 426, 475, 494, 425, 450, 358,  38, 262, 418,
       315,  46, 239,  87, 280, 230,  12, 152, 161,  28, 203, 319, 217,
        83, 310,  63, 318, 204, 432, 491, 113, 492,   3, 378, 440, 499,
       260, 334,  29, 237, 411, 331, 401, 208, 259, 473, 129,  85, 392,
       470, 110, 111, 243, 144,  97, 336, 253, 107, 109, 194, 145, 397,
       140, 114, 352,   6, 178, 284, 372, 463,  56, 148, 345, 137, 409,
       175,  61, 220, 299, 126, 164, 455,  36, 382, 459, 252, 215, 157,
       196, 333,   4, 449, 458,  58, 480, 263, 373,  25, 165, 452, 481,
       186, 446,  53,  98, 376, 171, 430, 368,  30, 324,  78, 351, 405,
       167, 214, 101,  94, 295, 130, 389, 460, 393, 308, 285, 229,  47,
       490, 271,  66, 191,  35, 197, 266, 102, 162, 386,   0, 407, 403,
       226, 435, 278, 447, 235, 347, 105,   8,  11,  41, 486, 245, 359,
       242, 225, 267, 374,  39, 371,  86, 433, 342, 456,  88, 276, 422,
       361, 354, 116, 369,  14,  75, 364, 484, 330, 257, 439, 316, 185,
       198, 200, 414, 163, 202, 261, 412, 187, 132, 281, 170, 172, 453,
        99, 496, 258, 302, 216, 468, 193, 410,  57, 274, 112,  77, 355,
       125,  23,   1, 339, 287,  54, 396, 190, 394, 454,  82, 289, 211,
        80, 417, 466,  26, 269, 443, 398, 479, 423,  48, 176,  51, 119,
        65, 131,  62, 166, 104,  27])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Rank-the-distance-to-10th-item">Rank the distance to 10th item<a class="anchor-link" href="#Rank-the-distance-to-10th-item">&#182;</a></h3><blockquote><p>Returning the similarity value also</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">order</span><span class="p">,</span> <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">return_similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span> <span class="s2">&quot;similarity&quot;</span><span class="p">:</span> <span class="n">similarity</span><span class="p">})</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>order</th>
      <th>similarity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>9</td>
      <td>0.146922</td>
    </tr>
    <tr>
      <td>1</td>
      <td>28</td>
      <td>0.122393</td>
    </tr>
    <tr>
      <td>2</td>
      <td>436</td>
      <td>0.122063</td>
    </tr>
    <tr>
      <td>3</td>
      <td>236</td>
      <td>0.121338</td>
    </tr>
    <tr>
      <td>4</td>
      <td>135</td>
      <td>0.120816</td>
    </tr>
    <tr>
      <td>5</td>
      <td>225</td>
      <td>0.120507</td>
    </tr>
    <tr>
      <td>6</td>
      <td>113</td>
      <td>0.120241</td>
    </tr>
    <tr>
      <td>7</td>
      <td>160</td>
      <td>0.120201</td>
    </tr>
    <tr>
      <td>8</td>
      <td>446</td>
      <td>0.119380</td>
    </tr>
    <tr>
      <td>9</td>
      <td>58</td>
      <td>0.119282</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Embedding-interpretation">Embedding interpretation<a class="anchor-link" href="#Embedding-interpretation">&#182;</a></h2><blockquote><p>Interpreting pytorch embedding matrix by utilizing <a href="https: //www.tensorflow.org/tensorboard">tensorboard</a> in colab</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="InterpEmbeddings" class="doc_header"><code>class</code> <code>InterpEmbeddings</code><a href="https://github.com/unpackai/unpackai/tree/master/unpackai/interp/latent.py#L57" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>InterpEmbeddings</code>(<strong><code>embedding_matrix</code></strong>:<code>ndarray</code>, <strong><code>vocab</code></strong>:<code>Dict</code>[<code>int</code>, <code>str</code>])</p>
</blockquote>
<p>interp = InterpEmbeddings(embedding_matrix, vocab_dict)</p>
<p>interp.search("computer")</p>
<h1 id="visualize-the-embedding-with-tensorboard">visualize the embedding with tensorboard<a class="anchor-link" href="#visualize-the-embedding-with-tensorboard">&#182;</a></h1><p>interp.visualize_in_tb()</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-for-other-task">Usage for other task<a class="anchor-link" href="#Usage-for-other-task">&#182;</a></h3><h4 id="eg.-recommender-sys">eg. recommender sys<a class="anchor-link" href="#eg.-recommender-sys">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Suppose we have 500 movies, that we do have learnt latent vectors on these movies</p>
<p>Given 1 movie,can we find the most similar ones</p>
<p>As we can create feature eg. "You watched &lt;...&gt;, You may also like..."</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NUM_ITEMS</span> <span class="o">=</span> <span class="mi">500</span>

<span class="c1"># an embedding maxtrix, in shape of</span>
<span class="n">movie_embedding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_ITEMS</span><span class="p">,</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># a dictionary mapping index to string</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;movie #</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_ITEMS</span><span class="p">,))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">InterpEmbeddings</span><span class="p">(</span><span class="n">movie_embedding</span><span class="p">,</span> <span class="n">vocab</span><span class="o">=</span><span class="n">vocab</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;movie #22&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<h3>Search with token id 22</h3>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tokens</th>
      <th>idx</th>
      <th>similarity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>movie #22</td>
      <td>22</td>
      <td>0.262194</td>
    </tr>
    <tr>
      <th>1</th>
      <td>movie #295</td>
      <td>295</td>
      <td>0.227033</td>
    </tr>
    <tr>
      <th>2</th>
      <td>movie #108</td>
      <td>108</td>
      <td>0.225516</td>
    </tr>
    <tr>
      <th>3</th>
      <td>movie #0</td>
      <td>0</td>
      <td>0.223599</td>
    </tr>
    <tr>
      <th>4</th>
      <td>movie #144</td>
      <td>144</td>
      <td>0.222527</td>
    </tr>
    <tr>
      <th>5</th>
      <td>movie #232</td>
      <td>232</td>
      <td>0.222521</td>
    </tr>
    <tr>
      <th>6</th>
      <td>movie #498</td>
      <td>498</td>
      <td>0.222113</td>
    </tr>
    <tr>
      <th>7</th>
      <td>movie #381</td>
      <td>381</td>
      <td>0.220832</td>
    </tr>
    <tr>
      <th>8</th>
      <td>movie #220</td>
      <td>220</td>
      <td>0.219798</td>
    </tr>
    <tr>
      <th>9</th>
      <td>movie #305</td>
      <td>305</td>
      <td>0.218822</td>
    </tr>
    <tr>
      <th>10</th>
      <td>movie #236</td>
      <td>236</td>
      <td>0.218546</td>
    </tr>
    <tr>
      <th>11</th>
      <td>movie #14</td>
      <td>14</td>
      <td>0.218388</td>
    </tr>
    <tr>
      <th>12</th>
      <td>movie #274</td>
      <td>274</td>
      <td>0.217985</td>
    </tr>
    <tr>
      <th>13</th>
      <td>movie #127</td>
      <td>127</td>
      <td>0.217889</td>
    </tr>
    <tr>
      <th>14</th>
      <td>movie #326</td>
      <td>326</td>
      <td>0.217152</td>
    </tr>
    <tr>
      <th>15</th>
      <td>movie #363</td>
      <td>363</td>
      <td>0.217147</td>
    </tr>
    <tr>
      <th>16</th>
      <td>movie #61</td>
      <td>61</td>
      <td>0.216979</td>
    </tr>
    <tr>
      <th>17</th>
      <td>movie #352</td>
      <td>352</td>
      <td>0.216956</td>
    </tr>
    <tr>
      <th>18</th>
      <td>movie #345</td>
      <td>345</td>
      <td>0.216823</td>
    </tr>
    <tr>
      <th>19</th>
      <td>movie #147</td>
      <td>147</td>
      <td>0.216784</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

